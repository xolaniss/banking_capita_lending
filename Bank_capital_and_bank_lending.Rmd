---
output:
  bookdown::pdf_document2:
    citation_package: natbib
    fig_caption: yes
    latex_engine: xelatex
    number_sections: yes
    toc: no
    keep_tex: true
    includes:
      in_header: preamble.tex
      before_body: title.tex
      # after_body: appendix_backcover.tex
  bookdown::word_document2:
    fig_width: 5 
    fig_height: 4
    reference_docx: new_template_no_numbering.docx
# title: "A Pandoc Markdown Article Starter and Template"
# thanks: "Replication files are available on the author's Github account..."
# author:
# date: "`r format(Sys.time(), '%B %d, %Y')`"
# abstract:
#  "This document provides an introduction to R Markdown, argues for its...  \\par \\textbf{Keywords:} one, two, three " 
# fontfamily: mathpazo
# fontsize: 12
# spacing: double
# documentclass: article
# classoption: fleqn
# paper: a4
csl: ucl-institute-of-education-harvard.csl
bibliography: references.bib
biblio-style: sarb.bst
natbiboptions: round
# link-citations: no
# linkcolor: blue!000!black
# urlcolor: blue!000!black
# citecolor: blue!000!black
# linestretch: 1.5
# indent: TRUE
---

```{r setup, include=FALSE}
options(scipen=999)
knitr::opts_chunk$set(echo = FALSE, 
                      warning = FALSE, 
                      message = FALSE, 
                      dpi = 500, 
                      fig.pos = "H", 
                      fig.align = "left", 
                      fig.env= 'figure', 
                      fig.height = 8,
                      tab.topcaption = FALSE,
                      ft.align = "left")
options(xtable.floating = TRUE,
        xtable.caption.placement = 'top', # notice \floatsetup overrides
        xtable.include.rownames = FALSE,
        xtable.comment = FALSE,
        xtable.booktabs = TRUE,
        xtable.table.placement = "H",
        xtable.tabular.environment = "tabularx",
        xtable.NA.string = "NA", 
        xtable.width = "\\textwidth", 
        xtable.size = "\\tiny", 
        xtable.hline.after = c(-1,0)
        )

```

```{r loading_packages, echo=FALSE}
library(tidyverse)
library(readr)
library(readxl)
library(zoo)
library(magick)
library(stringi)
library(patchwork)
library(xtable)
library(scales)
library(rvest)
library(rebus)
library(PNWColors)
library(lubridate)
library(here)
library(flextable)
library(gt)
library(officer)
library(modelsummary)

theme <-
  theme_minimal(base_size = 6) +
  theme(axis.text.x = element_text(angle = 90),
        legend.position = "none",) # EU base theme
theme_set(theme) # setting ggplot theme instead of using theme function
```

# Introduction
The paper investigates the impact of Basel III regulation on bank lending in South Africa. This introduction is an overview of the paper

# Context
A review of policy context, with focus on South Africa but also reference to other emerging markets. Further detail in Appendix 1 and 2a.

# Literature

@osborne2017good

@jokipii2008cyclical

@gambacorta2004does

@schwert2018bank

@kim2017effect

@carlson2013capital

@tabak2011bank

@altunbas2004bank

@gambacorta2018bank

@berrospide2010effects

# Model specification


# Estimation Results

# Conclusion

\newpage
# Appendix: Descriptive Analysis

## Data

### Capital Buffers

```{r}
#| capbuf,
#| fig.cap = "Capital buffers. Source: South African Reserve Bank (2022) REMOVE",
#| cache = FALSE,
#| include = TRUE

capital_buffers <- read_rds(here("Outputs", "artifacts_capital_buffers.rds"))

capital_buffers$graphs$big_banks_gg  #delete from the final draft

```
### BA 900 Quartelty Data


```{r}
#| ba900totals,
#| fig.cap = "Bank lending totals. Source: South African Reserve Bank (2022)",
#| cache = FALSE,
#| include = TRUE

ba900 <- read_rds(here("Outputs", "artifacts_balance_sheet_quartely.rds"))
ba900$quartely_graphs$Total_quartely_gg
```


```{r}
#| ba900absa,
#| fig.cap = "Absa bank lending. Source: South African Reserve Bank (2022) ",
#| cache = FALSE,
#| include = TRUE

ba900$quartely_graphs$absa_quartely_gg
```


```{r}
#| ba900fnb,
#| fig.cap = "FNB bank lending. Source: South African Reserve Bank (2022) ",
#| cache = FALSE,
#| include = TRUE

ba900$quartely_graphs$fnb_quartely_gg
```


```{r}
#| ba900nedbank,
#| fig.cap = "Nedbank bank lending. Source: South African Reserve Bank (2022) ",
#| cache = FALSE,
#| include = TRUE

ba900$quartely_graphs$nedbank_quartely_gg
```

```{r}
#| ba900standard,
#| fig.cap = "Standard bank lending. Source: South African Reserve Bank (2022) ",
#| cache = FALSE,
#| include = TRUE

ba900$quartely_graphs$standard_quartely_gg
```

```{r}
#| ba900capitec,
#| fig.cap = "Capitec bank lending. Source: South African Reserve Bank (2022)",
#| cache = FALSE,
#| include = TRUE

ba900$quartely_graphs$capitec_quartely_gg
```


### BA 900 to GDP

```{r}
#| nominal,
#| fig.cap = "Nominal GDP. Source: South African Reserve Bank (2022)",
#| cache = FALSE,
#| fig.height = 3,
#| include = TRUE

balance_sheet_gdp <- read_rds(here("Outputs", "artifacts_balance_sheet_gdp.rds"))
balance_sheet_gdp$graphs$nominal_GDP_gg
```


```{r}
#| ba900gdptotals,
#| fig.cap = "Total bank lending as a percent of GDP. Source: South African Reserve Bank (2022)",
#| cache = FALSE,
#| include = TRUE

balance_sheet_gdp$graphs$total_gdp_gg
```
```{r}
#| ba900gdpfnb,
#| fig.cap = "FNB lending as a percent of GDP. Source: South African Reserve Bank (2022)",
#| cache = FALSE,
#| include = TRUE

balance_sheet_gdp$graphs$fnb_gdp_gg
```

```{r}
#| ba900gdpabsa,
#| fig.cap = "Absa lending as a percent of GDP. Source: South African Reserve Bank (2022)",
#| cache = FALSE,
#| include = TRUE

balance_sheet_gdp$graphs$absa_gdp_gg
```

```{r}
#| ba900gdpstandard,
#| fig.cap = "Standard bank lending as percent of GDP. Source: South African Reserve Bank (2022)",
#| cache = FALSE,
#| include = TRUE

balance_sheet_gdp$graphs$standard_gdp_gg
```

```{r}
#| ba900gdpnedbank,
#| fig.cap = "Nedbank lending as percent of GDP. Source: South African Reserve Bank (2022)",
#| cache = FALSE,
#| include = TRUE

balance_sheet_gdp$graphs$nedbank_gdp_gg
```

```{r}
#| ba900gdpcapitec,
#| fig.cap = "Capitec lending as percent of GDP. Source: South African Reserve Bank (2022)",
#| cache = FALSE,
#| include = TRUE

balance_sheet_gdp$graphs$capitec_gdp_gg
```

\newpage
# Appendix: Detailed Literature Review

More detailed literature review

\newpage
# References
